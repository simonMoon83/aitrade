{% extends "base.html" %}

{% block title %}AI íŠ¸ë ˆì´ë” - ì¼ì¼ ë ˆí¬íŠ¸{% endblock %}

{% block content %}
<div class="card">
    <h3>ğŸ“‹ ì¼ì¼ ì„±ê³¼ ë ˆí¬íŠ¸</h3>
    <div class="table-container">
        <table class="table" id="reports-table">
            <thead>
                <tr>
                    <th>ë‚ ì§œ</th>
                    <th>ì´ ê±°ë˜ìˆ˜</th>
                    <th>ìŠ¹ë¥ </th>
                    <th>ìˆ˜ìµê¸ˆ</th>
                    <th>ìˆ˜ìµë¥ </th>
                    <th>ìµœëŒ€ ë‚™í­ (MDD)</th>
                    <th>ìƒ¤í”„ ì§€ìˆ˜</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="7" style="text-align:center; padding: 2rem; color:#999;">ë°ì´í„° ë¡œë”© ì¤‘...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/api/reports')
            .then(response => response.json())
            .then(data => {
                const reports = data.reports || data;
                const tbody = document.querySelector('#reports-table tbody');
                tbody.innerHTML = '';

                if (!reports || reports.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 2rem; color:#999;">ìƒì„±ëœ ë ˆí¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }

                // reports.sort((a, b) => new Date(b.date) - new Date(a.date));

                reports.forEach(report => {
                    const row = tbody.insertRow();
                    const profit = report.profit || 0;
                    const return_pct = (report.return_pct || 0) * 100;

                    row.innerHTML = `
                        <td style="font-weight:600;">${report.date}</td>
                        <td>${report.total_trades}íšŒ</td>
                        <td>${(report.win_rate * 100).toFixed(1)}%</td>
                        <td class="${profit >= 0 ? 'text-success' : 'text-danger'}">$${profit.toFixed(2)}</td>
                        <td class="${return_pct >= 0 ? 'text-success' : 'text-danger'}">${return_pct.toFixed(2)}%</td>
                        <td class="text-danger">-${(report.mdd * 100).toFixed(2)}%</td>
                        <td>${report.sharpe_ratio.toFixed(2)}</td>
                    `;
                });
            })
            .catch(error => {
                console.error('Error:', error);
                document.querySelector('#reports-table tbody').innerHTML =
                    '<tr><td colspan="7" style="text-align:center; color:red;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
            });
    });
</script>
{% endblock %}