<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ ë·°ì–´ - AI íŠ¸ë ˆì´ë”</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header h1 { font-size: 28px; font-weight: 600; }
        .logout-btn { background: rgba(255,255,255,0.2); color: white; padding: 10px 20px; border: 2px solid white; border-radius: 6px; cursor: pointer; transition: all 0.3s; }
        .logout-btn:hover { background: white; color: #667eea; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .navbar { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.08); padding: 0; margin-bottom: 20px; }
        .navbar ul { list-style: none; display: flex; margin: 0; padding: 0; }
        .navbar li { flex: 1; }
        .navbar a { display: block; padding: 15px 20px; text-decoration: none; color: #333; transition: all 0.3s; text-align: center; border-bottom: 3px solid transparent; }
        .navbar a:hover, .navbar a.active { background: #f8f9fa; border-bottom-color: #667eea; color: #667eea; font-weight: 600; }
        
        .container { max-width: 1600px; margin: 20px auto; padding: 0 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card h3 { margin-bottom: 15px; color: #2c3e50; }
        
        /* í•„í„° */
        .filter-panel { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; align-items: center; }
        .filter-panel select, .filter-panel input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .filter-panel button { background: #667eea; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .filter-panel button:hover { background: #5568d3; }
        .filter-panel > label { display: flex; align-items: center; gap: 6px; white-space: nowrap; cursor: pointer; font-size: 13px; }
        .filter-panel input[type="checkbox"] { cursor: pointer; width: auto; min-width: 16px; flex-shrink: 0; }
        
        /* ë¡œê·¸ ì»¨í…Œì´ë„ˆ */
        .log-container { background: #1e1e1e; color: #d4d4d4; font-family: 'Courier New', Consolas, monospace; padding: 20px; border-radius: 8px; max-height: 600px; overflow-y: auto; font-size: 13px; line-height: 1.5; }
        .log-entry { margin-bottom: 2px; padding: 4px 8px; border-radius: 3px; transition: background 0.2s; }
        .log-entry:hover { background: rgba(255,255,255,0.05); }
        
        /* ë¡œê·¸ ë ˆë²¨ ìƒ‰ìƒ */
        .log-info { color: #4fc3f7; }
        .log-warning { color: #ffb74d; }
        .log-error { color: #f44336; }
        .log-debug { color: #9e9e9e; }
        
        .log-timestamp { color: #888; }
        .log-level { font-weight: bold; padding: 2px 6px; border-radius: 3px; margin: 0 4px; }
        .log-level.INFO { background: rgba(79, 195, 247, 0.2); color: #4fc3f7; }
        .log-level.WARNING { background: rgba(255, 183, 77, 0.2); color: #ffb74d; }
        .log-level.ERROR { background: rgba(244, 67, 54, 0.2); color: #f44336; }
        .log-level.DEBUG { background: rgba(158, 158, 158, 0.2); color: #9e9e9e; }
        
        .log-message { color: #d4d4d4; }
        
        
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .stat-item { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .stat-value { font-size: 24px; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 12px; color: #666; margin-top: 5px; }
        
        .no-logs { text-align: center; padding: 60px 20px; color: #999; }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 10px; text-align: center; }
            .header h1 { font-size: 22px; }
            /* ëª¨ë°”ì¼ì—ì„œë„ ë©”ë‰´ëŠ” ê°€ë¡œ ìœ ì§€ (2ì¤„ë¡œ í‘œì‹œ) */
            .navbar ul { flex-wrap: wrap; }
            .navbar li { flex: 1 1 50%; min-width: 50%; }
            .navbar a { border-bottom: 1px solid #eee; border-right: 1px solid #eee; padding: 12px 10px; font-size: 14px; }
            .filter-panel { flex-direction: column; gap: 10px; align-items: stretch; }
            .filter-panel select, .filter-panel button { width: 100%; }
            .filter-panel > label { 
                width: auto; 
                display: flex; 
                align-items: center; 
                align-self: flex-start;
                gap: 8px;
            }
            .stats { grid-template-columns: 1fr 1fr; }
            .log-container { max-height: 400px; font-size: 11px; padding: 15px; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 0 10px; }
            .card { padding: 15px; }
            .header h1 { font-size: 18px; }
            .stats { grid-template-columns: 1fr; }
            .log-container { font-size: 10px; padding: 10px; }
            /* ì²´í¬ë°•ìŠ¤ë¥¼ ë” ëª…í™•í•˜ê²Œ */
            .filter-panel > label { 
                font-size: 13px; 
                padding: 8px 0; 
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“ ì‹¤ì‹œê°„ ë¡œê·¸ ë·°ì–´</h1>
        <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar">
        <ul>
            <li><a href="/">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a></li>
            <li><a href="/history">ğŸ“ˆ ê±°ë˜ ì´ë ¥</a></li>
            <li><a href="/signals">ğŸ¯ AI ì‹ í˜¸</a></li>
            <li><a href="/reports">ğŸ“‹ ì¼ì¼ ë ˆí¬íŠ¸</a></li>
            <li><a href="/logs_page" class="active">ğŸ“ ë¡œê·¸</a></li>
        </ul>
    </nav>
    
    <div class="container">
        <!-- í†µê³„ -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-logs">0</div>
                <div class="stat-label">ì „ì²´ ë¡œê·¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="error-count" style="color: #f44336;">0</div>
                <div class="stat-label">ì—ëŸ¬</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="warning-count" style="color: #ffb74d;">0</div>
                <div class="stat-label">ê²½ê³ </div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="info-count" style="color: #4fc3f7;">0</div>
                <div class="stat-label">ì •ë³´</div>
            </div>
        </div>
        
        <div class="card">
            <h3>ğŸ” í•„í„° ë° ì„¤ì •</h3>
            <div class="filter-panel">
                <select id="log-type-filter">
                    <option value="paper_trader">Paper Trader</option>
                    <option value="main">Main</option>
                    <option value="improved_buy_low_sell_high">Strategy</option>
                    <option value="data_collector">Data Collector</option>
                </select>
                
                <select id="level-filter">
                    <option value="ALL">ì „ì²´ ë ˆë²¨</option>
                    <option value="INFO">INFO</option>
                    <option value="WARNING">WARNING</option>
                    <option value="ERROR">ERROR</option>
                    <option value="DEBUG">DEBUG</option>
                </select>
                
                <select id="limit-filter">
                    <option value="100">100ì¤„</option>
                    <option value="200">200ì¤„</option>
                    <option value="500">500ì¤„</option>
                    <option value="1000">1000ì¤„</option>
                </select>
                
                <button onclick="loadLogs()">ìƒˆë¡œê³ ì¹¨</button>
                <button onclick="clearLogView()" style="background: #e74c3c;">ì§€ìš°ê¸°</button>
                
                <label>
                    <input type="checkbox" id="auto-scroll" checked>
                    ìë™ ìŠ¤í¬ë¡¤
                </label>
                
                <label>
                    <input type="checkbox" id="auto-refresh" checked>
                    ìë™ ìƒˆë¡œê³ ì¹¨ (5ì´ˆ)
                </label>
            </div>
        </div>
        
        <div class="card">
            <h3>ğŸ“‹ ë¡œê·¸ (ì‹¤ì‹œê°„)</h3>
            <div class="log-container" id="log-container">
                <div class="no-logs">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>
    </div>
    
    <script>
        let autoRefreshInterval = null;
        let stats = { total: 0, error: 0, warning: 0, info: 0 };
        
        function logout() {
            window.location.href = '/logout';
        }
        
        function loadLogs() {
            const logType = document.getElementById('log-type-filter').value;
            const level = document.getElementById('level-filter').value;
            const limit = document.getElementById('limit-filter').value;
            
            const params = new URLSearchParams({
                type: logType,
                level: level,
                limit: limit
            });
            
            fetch(`/api/logs?${params}`)
                .then(response => response.json())
                .then(data => {
                    updateLogDisplay(data.logs || []);
                    updateStats(data.logs || []);
                })
                .catch(error => {
                    console.error('Error:', error);
                    showError();
                });
        }
        
        function updateLogDisplay(logs) {
            const container = document.getElementById('log-container');
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="no-logs">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            const logsHTML = logs.map(log => {
                const level = log.level || 'INFO';
                const levelClass = level.toLowerCase();
                
                return `
                    <div class="log-entry log-${levelClass}">
                        <span class="log-timestamp">${log.timestamp}</span>
                        <span class="log-level ${level}">${level}</span>
                        <span class="log-message">${escapeHtml(log.message)}</span>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = logsHTML;
            
            // ìë™ ìŠ¤í¬ë¡¤
            if (document.getElementById('auto-scroll').checked) {
                container.scrollTop = container.scrollHeight;
            }
        }
        
        function updateStats(logs) {
            stats = { total: logs.length, error: 0, warning: 0, info: 0 };
            
            logs.forEach(log => {
                const level = log.level || 'INFO';
                if (level === 'ERROR') stats.error++;
                else if (level === 'WARNING') stats.warning++;
                else if (level === 'INFO') stats.info++;
            });
            
            document.getElementById('total-logs').textContent = stats.total;
            document.getElementById('error-count').textContent = stats.error;
            document.getElementById('warning-count').textContent = stats.warning;
            document.getElementById('info-count').textContent = stats.info;
        }
        
        function clearLogView() {
            document.getElementById('log-container').innerHTML = '<div class="no-logs">ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</div>';
            stats = { total: 0, error: 0, warning: 0, info: 0 };
            updateStats([]);
        }
        
        function showError() {
            const container = document.getElementById('log-container');
            container.innerHTML = '<div class="no-logs" style="color: #e74c3c;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        function setupAutoRefresh() {
            const autoRefreshCheckbox = document.getElementById('auto-refresh');
            
            if (autoRefreshCheckbox.checked) {
                autoRefreshInterval = setInterval(loadLogs, 5000);
            } else {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            }
        }
        
        // ì´ˆê¸° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadLogs();
            setupAutoRefresh();
            
            // ìë™ ìƒˆë¡œê³ ì¹¨ í† ê¸€
            document.getElementById('auto-refresh').addEventListener('change', setupAutoRefresh);
            
            // í•„í„° ë³€ê²½ ì‹œ ë¡œê·¸ ìƒˆë¡œê³ ì¹¨
            document.getElementById('log-type-filter').addEventListener('change', loadLogs);
            document.getElementById('level-filter').addEventListener('change', loadLogs);
            document.getElementById('limit-filter').addEventListener('change', loadLogs);
        });
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì¸í„°ë²Œ ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>

