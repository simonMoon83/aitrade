{% extends "base.html" %}

{% block title %}AI íŠ¸ë ˆì´ë” - ê±°ë˜ ì´ë ¥{% endblock %}

{% block content %}
<div class="card">
    <h3>ğŸ“ˆ ì „ì²´ ê±°ë˜ ì´ë ¥</h3>
    <div class="table-container">
        <table class="table" id="history-table">
            <thead>
                <tr>
                    <th>ì‹œê°„</th>
                    <th>ì¢…ëª©</th>
                    <th>ìœ í˜•</th>
                    <th>ìˆ˜ëŸ‰</th>
                    <th>ê°€ê²©</th>
                    <th>ì´ì•¡</th>
                    <th>ì†ìµ</th>
                </tr>
            </thead>
            <tbody>
                <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                <tr>
                    <td colspan="7" style="text-align:center; padding: 2rem; color:#999;">ë°ì´í„° ë¡œë”© ì¤‘...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/api/trades')
            .then(response => response.json())
            .then(data => {
                const trades = data.trades || data;
                const tbody = document.querySelector('#history-table tbody');
                tbody.innerHTML = '';

                if (!trades || trades.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 2rem; color:#999;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }

                // trades.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                trades.forEach(trade => {
                    const row = tbody.insertRow();
                    const total = trade.price * trade.quantity;
                    const pnl = trade.pnl || 0;
                    const isBuy = trade.order_type === 'buy';

                    row.innerHTML = `
                        <td style="color:#64748b;">${new Date(trade.timestamp).toLocaleString()}</td>
                        <td style="font-weight:600;">${trade.symbol}</td>
                        <td><span class="badge ${isBuy ? 'badge-success' : 'badge-danger'}">${trade.order_type.toUpperCase()}</span></td>
                        <td>${trade.quantity}</td>
                        <td>$${trade.price.toFixed(2)}</td>
                        <td>$${total.toFixed(2)}</td>
                        <td class="${pnl >= 0 ? 'text-success' : 'text-danger'}">${pnl ? '$' + pnl.toFixed(2) : '-'}</td>
                    `;
                });
            })
            .catch(error => {
                console.error('Error:', error);
                document.querySelector('#history-table tbody').innerHTML =
                    '<tr><td colspan="7" style="text-align:center; color:red;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
            });
    });
</script>
{% endblock %}