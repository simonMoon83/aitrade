{% extends "base.html" %}

{% block title %}AI íŠ¸ë ˆì´ë” - AI ì‹ í˜¸{% endblock %}

{% block content %}
<div class="card">
    <h3>ğŸ¯ AI ë§¤ë§¤ ì‹ í˜¸ ì´ë ¥</h3>
    <div class="table-container">
        <table class="table" id="signals-table">
            <thead>
                <tr>
                    <th>ì‹œê°„</th>
                    <th>ì¢…ëª©</th>
                    <th>ì‹ í˜¸</th>
                    <th>ì‹ ë¢°ë„</th>
                    <th>í˜„ì¬ê°€</th>
                    <th>ëª©í‘œê°€</th>
                    <th>ì†ì ˆê°€</th>
                    <th>ì´ìœ </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="8" style="text-align:center; padding: 2rem; color:#999;">ë°ì´í„° ë¡œë”© ì¤‘...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/api/signals')
            .then(response => response.json())
            .then(data => {
                const signals = data.signals || data;
                const tbody = document.querySelector('#signals-table tbody');
                tbody.innerHTML = '';

                if (!signals || signals.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding: 2rem; color:#999;">ìƒì„±ëœ ì‹ í˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }

                // signals.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                signals.forEach(signal => {
                    const row = tbody.insertRow();
                    const isBuy = signal.signal === 'buy';
                    const confidence = (signal.confidence * 100).toFixed(1);

                    row.innerHTML = `
                        <td style="color:#64748b;">${new Date(signal.timestamp).toLocaleString()}</td>
                        <td style="font-weight:600;">${signal.symbol}</td>
                        <td><span class="badge ${isBuy ? 'badge-success' : 'badge-danger'}">${signal.signal.toUpperCase()}</span></td>
                        <td>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <div style="width:50px; height:4px; background:#e2e8f0; border-radius:2px;">
                                    <div style="width:${confidence}%; height:100%; background:${isBuy ? '#27ae60' : '#e74c3c'}; border-radius:2px;"></div>
                                </div>
                                <span style="font-size:0.85rem;">${confidence}%</span>
                            </div>
                        </td>
                        <td>$${signal.current_price.toFixed(2)}</td>
                        <td>$${signal.target_price ? signal.target_price.toFixed(2) : '-'}</td>
                        <td>$${signal.stop_loss ? signal.stop_loss.toFixed(2) : '-'}</td>
                        <td style="max-width:300px; font-size:0.9rem; color:#475569;">${signal.reason}</td>
                    `;
                });
            })
            .catch(error => {
                console.error('Error:', error);
                document.querySelector('#signals-table tbody').innerHTML =
                    '<tr><td colspan="8" style="text-align:center; color:red;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
            });
    });
</script>
{% endblock %}