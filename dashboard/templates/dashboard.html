
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AI íŠ¸ë ˆì´ë” ëŒ€ì‹œë³´ë“œ</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
            .header h1 { font-size: 28px; font-weight: 600; }
            .logout-btn { background: rgba(255,255,255,0.2); color: white; padding: 10px 20px; border: 2px solid white; border-radius: 6px; cursor: pointer; transition: all 0.3s; }
            .logout-btn:hover { background: white; color: #667eea; }
            
            /* ë„¤ë¹„ê²Œì´ì…˜ */
            .navbar { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.08); padding: 0; margin-bottom: 20px; }
            .navbar ul { list-style: none; display: flex; margin: 0; padding: 0; }
            .navbar li { flex: 1; }
            .navbar a { display: block; padding: 15px 20px; text-decoration: none; color: #333; transition: all 0.3s; text-align: center; border-bottom: 3px solid transparent; }
            .navbar a:hover, .navbar a.active { background: #f8f9fa; border-bottom-color: #667eea; color: #667eea; font-weight: 600; }
            .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
            .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
            .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
            .card h3 { margin-bottom: 15px; color: #2c3e50; }
            .metric { display: flex; justify-content: space-between; margin-bottom: 10px; }
            .metric-value { font-weight: bold; }
            .positive { color: #27ae60; }
            .negative { color: #e74c3c; }
            .control-panel { display: flex; gap: 10px; margin-bottom: 20px; }
            .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
            .btn-start { background: #27ae60; color: white; }
            .btn-stop { background: #e74c3c; color: white; }
            .btn-emergency { background: #f39c12; color: white; }
            .status { padding: 10px; border-radius: 4px; margin-bottom: 20px; }
            .status.running { background: #d4edda; color: #155724; }
            .status.stopped { background: #f8d7da; color: #721c24; }
            .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
            .table th, .table td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
            .table th { background-color: #f8f9fa; }
            .refresh-btn { background: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
            
            /* ë°˜ì‘í˜• ë””ìì¸ */
            @media (max-width: 768px) {
                .header { flex-direction: column; gap: 10px; text-align: center; }
                .header h1 { font-size: 22px; }
                /* ëª¨ë°”ì¼ì—ì„œë„ ë©”ë‰´ëŠ” ê°€ë¡œ ìœ ì§€ (2ì¤„ë¡œ í‘œì‹œ) */
                .navbar ul { flex-wrap: wrap; }
                .navbar li { flex: 1 1 50%; min-width: 50%; }
                .navbar a { border-bottom: 1px solid #eee; border-right: 1px solid #eee; padding: 12px 10px; font-size: 14px; }
                .dashboard-grid { grid-template-columns: 1fr; }
                .control-panel { flex-direction: column; }
                .control-panel button { width: 100%; }
                .metric { font-size: 14px; }
                .table { font-size: 12px; }
                .table th, .table td { padding: 6px; }
            }
            
            @media (max-width: 480px) {
                .container { padding: 0 10px; }
                .card { padding: 15px; }
                .header h1 { font-size: 18px; }
                .metric-value { font-size: 20px !important; }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>ğŸ¤– AI ì£¼ì‹ íŠ¸ë ˆì´ë” ëŒ€ì‹œë³´ë“œ</h1>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        
        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="navbar">
            <ul>
                <li><a href="/" class="active">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="/history">ğŸ“ˆ ê±°ë˜ ì´ë ¥</a></li>
                <li><a href="/signals">ğŸ¯ AI ì‹ í˜¸</a></li>
                <li><a href="/reports">ğŸ“‹ ì¼ì¼ ë ˆí¬íŠ¸</a></li>
                <li><a href="/logs_page">ğŸ“ ë¡œê·¸</a></li>
            </ul>
        </nav>
        
        <div class="container">
            <div class="control-panel">
                <button class="btn btn-start" onclick="controlTrader('start')">ê±°ë˜ ì‹œì‘</button>
                <button class="btn btn-stop" onclick="controlTrader('stop')">ê±°ë˜ ì¤‘ì§€</button>
                <button class="btn btn-emergency" onclick="controlTrader('emergency_stop')">ê¸´ê¸‰ ì •ì§€</button>
                <button class="refresh-btn" onclick="refreshData()">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            
            <div id="status" class="status stopped">ìƒíƒœ: ì¤‘ì§€ë¨</div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <h3>í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©</h3>
                    <div id="portfolio-info">
                        <div class="metric">
                            <span>í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜:</span>
                            <span class="metric-value" id="portfolio-value">$0</span>
                        </div>
                        <div class="metric">
                            <span>í˜„ê¸ˆ:</span>
                            <span class="metric-value" id="cash">$0</span>
                        </div>
                        <div class="metric">
                            <span>ì´ ìˆ˜ìµë¥ :</span>
                            <span class="metric-value" id="total-return">0%</span>
                        </div>
                        <div class="metric">
                            <span>ë³´ìœ  í¬ì§€ì…˜:</span>
                            <span class="metric-value" id="num-positions">0ê°œ</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>ê±°ë˜ í˜„í™©</h3>
                    <div id="trading-info">
                        <div class="metric">
                            <span>ì¼ì¼ ê±°ë˜:</span>
                            <span class="metric-value" id="daily-trades">0íšŒ</span>
                        </div>
                        <div class="metric">
                            <span>ê±°ë˜ ìƒíƒœ:</span>
                            <span class="metric-value" id="trading-status">ì¤‘ì§€</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>ë³´ìœ  í¬ì§€ì…˜</h3>
                    <div id="positions-table">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ì¢…ëª©</th>
                                    <th>ìˆ˜ëŸ‰</th>
                                    <th>í‰ê· ê°€</th>
                                    <th>í˜„ì¬ê°€</th>
                                    <th>ì†ìµ</th>
                                </tr>
                            </thead>
                            <tbody id="positions-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>ìµœê·¼ ê±°ë˜</h3>
                    <div id="trades-table">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ì‹œê°„</th>
                                    <th>ì¢…ëª©</th>
                                    <th>ê±°ë˜</th>
                                    <th>ìˆ˜ëŸ‰</th>
                                    <th>ê°€ê²©</th>
                                    <th>ì†ìµ</th>
                                </tr>
                            </thead>
                            <tbody id="trades-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ì„±ê³¼ ì°¨íŠ¸ -->
            <div class="card">
                <h3>ğŸ“ˆ ì„±ê³¼ ì°¨íŠ¸ (ìµœê·¼ 30ì¼)</h3>
                <canvas id="performanceChart" style="max-height: 400px;"></canvas>
            </div>
            
            <!-- Export ê¸°ëŠ¥ -->
            <div class="card" style="margin-top: 20px;">
                <h3>ğŸ’¾ ë°ì´í„° Export</h3>
                <button class="btn" style="background: #28a745;" onclick="exportTrades()">ê±°ë˜ ë‚´ì—­ CSV ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
        
        <script>
            let refreshInterval;
            let performanceChart = null;
            
            function logout() {
                window.location.href = '/logout';
            }
            
            function controlTrader(action) {
                fetch('/api/control', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({action: action})
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Control response:', data);
                    refreshData();
                })
                .catch(error => {
                    console.error('Control error:', error);
                });
            }
            
            function refreshData() {
                // í¬íŠ¸í´ë¦¬ì˜¤ ì •ë³´ ì—…ë°ì´íŠ¸
                fetch('/api/portfolio')
                    .then(response => response.json())
                    .then(data => {
                        updatePortfolioInfo(data);
                    })
                    .catch(error => console.error('Portfolio error:', error));
                
                // ê±°ë˜ ë‚´ì—­ ì—…ë°ì´íŠ¸
                fetch('/api/trades')
                    .then(response => response.json())
                    .then(data => {
                        updateTradesTable(data.trades || data);
                    })
                    .catch(error => console.error('Trades error:', error));
                
                // ì„±ê³¼ ì •ë³´ ì—…ë°ì´íŠ¸
                fetch('/api/performance')
                    .then(response => response.json())
                    .then(data => {
                        updatePerformanceInfo(data);
                    })
                    .catch(error => console.error('Performance error:', error));
                
                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                fetch('/api/performance/chart?days=30')
                    .then(response => response.json())
                    .then(data => {
                        updatePerformanceChart(data);
                    })
                    .catch(error => console.error('Chart error:', error));
            }
            
            function exportTrades() {
                window.location.href = '/api/export/trades';
            }
            
            function updatePortfolioInfo(data) {
                document.getElementById('portfolio-value').textContent = '$' + (data.portfolio_value || 0).toLocaleString();
                document.getElementById('cash').textContent = '$' + (data.cash || 0).toLocaleString();
                
                const totalReturn = (data.total_return || 0) * 100;
                const returnElement = document.getElementById('total-return');
                returnElement.textContent = totalReturn.toFixed(2) + '%';
                returnElement.className = 'metric-value ' + (totalReturn >= 0 ? 'positive' : 'negative');
                
                document.getElementById('num-positions').textContent = Object.keys(data.positions || {}).length + 'ê°œ';
                
                // í¬ì§€ì…˜ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updatePositionsTable(data.positions || {});
            }
            
            function updatePositionsTable(positions) {
                const tbody = document.getElementById('positions-tbody');
                tbody.innerHTML = '';
                
                for (const [symbol, pos] of Object.entries(positions)) {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = symbol;
                    row.insertCell(1).textContent = pos.quantity;
                    row.insertCell(2).textContent = '$' + pos.avg_price.toFixed(2);
                    row.insertCell(3).textContent = '$' + pos.current_price.toFixed(2);
                    
                    const pnlCell = row.insertCell(4);
                    pnlCell.textContent = '$' + pos.unrealized_pnl.toFixed(2);
                    pnlCell.className = pos.unrealized_pnl >= 0 ? 'positive' : 'negative';
                }
            }
            
            function updateTradesTable(trades) {
                const tbody = document.getElementById('trades-tbody');
                tbody.innerHTML = '';
                
                trades.slice(-10).reverse().forEach(trade => {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = new Date(trade.timestamp).toLocaleString();
                    row.insertCell(1).textContent = trade.symbol;
                    row.insertCell(2).textContent = trade.order_type;
                    row.insertCell(3).textContent = trade.quantity;
                    row.insertCell(4).textContent = '$' + trade.price.toFixed(2);
                    
                    const pnlCell = row.insertCell(5);
                    pnlCell.textContent = '$' + (trade.pnl || 0).toFixed(2);
                    pnlCell.className = (trade.pnl || 0) >= 0 ? 'positive' : 'negative';
                });
            }
            
            function updatePerformanceInfo(data) {
                document.getElementById('daily-trades').textContent = (data.daily_trades || 0) + 'íšŒ';
                document.getElementById('trading-status').textContent = data.is_running ? 'ì‹¤í–‰ ì¤‘' : 'ì¤‘ì§€';
                
                // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
                const statusElement = document.getElementById('status');
                statusElement.textContent = 'ìƒíƒœ: ' + (data.is_running ? 'ì‹¤í–‰ ì¤‘' : 'ì¤‘ì§€ë¨');
                statusElement.className = 'status ' + (data.is_running ? 'running' : 'stopped');
            }
            
            function updatePerformanceChart(data) {
                const ctx = document.getElementById('performanceChart');
                if (!ctx) return;
                
                // ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ
                if (performanceChart) {
                    performanceChart.destroy();
                }
                
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ì°¨íŠ¸
                if (!data.labels || data.labels.length === 0) {
                    ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                    return;
                }
                
                // ìƒˆ ì°¨íŠ¸ ìƒì„±
                performanceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ ($)',
                            data: data.portfolio_values,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += '$' + context.parsed.y.toLocaleString();
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // ì´ˆê¸° ë¡œë“œ
            document.addEventListener('DOMContentLoaded', function() {
                refreshData();
                
                // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
                refreshInterval = setInterval(refreshData, 30000);
            });
            
            // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì¸í„°ë²Œ ì •ë¦¬
            window.addEventListener('beforeunload', function() {
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            });
        </script>
    </body>
    </html>
    